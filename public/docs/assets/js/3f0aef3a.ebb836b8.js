"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6688],{7802:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>c,frontMatter:()=>i,metadata:()=>d,toc:()=>a});var r=o(5893),s=o(1151);const i={sidebar_position:3,title:"Production & Deployment"},t="Production & Deployment",d={id:"getting-started/production",title:"Production & Deployment",description:"SaaSykit comes with integration of PHP Deployer for deployment. You can use it to provision and deploy your application to any server.",source:"@site/docs/getting-started/production.md",sourceDirName:"getting-started",slug:"/getting-started/production",permalink:"/docs/getting-started/production",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Production & Deployment"},sidebar:"tutorialSidebar",previous:{title:"Local development",permalink:"/docs/getting-started/development"},next:{title:"Product Launch Check List",permalink:"/docs/getting-started/new-product-check-list"}},l={},a=[{value:"Provisioning your server",id:"provisioning-your-server",level:2},{value:"How Deployer provisions your server",id:"how-deployer-provisions-your-server",level:3},{value:"Deploying your app",id:"deploying-your-app",level:2},{value:"Creating your admin user",id:"creating-your-admin-user",level:2},{value:"Next steps",id:"next-steps",level:2},{value:"Queue workers",id:"queue-workers",level:2},{value:"Troubleshooting &amp; FAQs",id:"troubleshooting--faqs",level:2},{value:"The connection for this site is not secure?",id:"the-connection-for-this-site-is-not-secure",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"production--deployment",children:"Production & Deployment"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"SaaSykit"})," comes with integration of ",(0,r.jsx)(n.a,{href:"https://deployer.org/",children:"PHP Deployer"})," for deployment. You can use it to provision and deploy your application to any server."]}),"\n",(0,r.jsx)(n.p,{children:"Deployer offer a zero downtime deployment, rollbacks, parallel deployment (in case your have multiple servers), and many more features. All that using a single deployment command."}),"\n",(0,r.jsx)(n.p,{children:"It's not necessary to use Deployer for provisioning your server if you prefer to do it on your own. You can use Deployer only for deployment."}),"\n",(0,r.jsx)(n.h2,{id:"provisioning-your-server",children:"Provisioning your server"}),"\n",(0,r.jsx)(n.p,{children:"If you prefer to provision your server on your own, you can skip this step."}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"Deployer only supports Ubuntu 20.04 LTS (focal) for provisioning. So make sure that your server is running Ubuntu 20.04 LTS before proceeding."})}),"\n",(0,r.jsx)(n.h3,{id:"how-deployer-provisions-your-server",children:"How Deployer provisions your server"}),"\n",(0,r.jsxs)(n.p,{children:["Deployer comes with a set of recipes that are divided into tasks. Each task is responsible for a specific job. For example, the ",(0,r.jsx)(n.code,{children:"deploy:prepare"})," task is responsible for creating the necessary directories for deployment."]}),"\n",(0,r.jsxs)(n.p,{children:["Deployers works from within your local machine, it connects to your server using SSH and executes the tasks on the server. You can configure it to run within ",(0,r.jsx)(n.a,{href:"https://deployer.org/docs/7.x/ci-cd",children:"CI/CD pipelines"})," as well."]}),"\n",(0,r.jsxs)(n.p,{children:["Deployer uses the ",(0,r.jsx)(n.code,{children:"deploy.php"})," file (shipped in ",(0,r.jsx)(n.strong,{children:"SaaSykit"})," code already) to configure the deployment/provisioning process. It will install the necessary packages like (php, mysql, redis, caddy web server, etc.) and configure them for you."]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you plan to have your application deployed on multiple servers, you would need to edit the ",(0,r.jsx)(n.code,{children:"deploy.php"})," file and add the necessary configuration for each server."]})}),"\n",(0,r.jsxs)(n.p,{children:["If you choose to use Deployer to provision your server, it will create a new user with the name ",(0,r.jsx)(n.code,{children:"deployer"})," and add it to the ",(0,r.jsx)(n.code,{children:"sudo"})," group. This will be the user that will be used for deployment."]}),"\n",(0,r.jsx)(n.p,{children:"To provision your server using Deployer:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Get a server with Ubuntu 20.04 LTS installed, from any cloud provider. (e.g. ",(0,r.jsx)(n.a,{href:"https://www.digitalocean.com/",children:"DigitalOcean"}),", ",(0,r.jsx)(n.a,{href:"https://www.linode.com/",children:"Linode"}),", ",(0,r.jsx)(n.a,{href:"https://www.vultr.com/",children:"Vultr"}),", ",(0,r.jsx)(n.a,{href:"https://aws.amazon.com/",children:"AWS"}),", ",(0,r.jsx)(n.a,{href:"https://cloud.google.com/",children:"Google Cloud"}),", ",(0,r.jsx)(n.a,{href:"https://www.hetzner.com/",children:"Hetzner"}),", etc.)"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["CD into code directory of ",(0,r.jsx)(n.strong,{children:"SaaSykit"})," (where composer.json file is located):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd /path/to/saasykit\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Install composer packages (if you didn't already):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"composer install\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Open the ",(0,r.jsx)(n.code,{children:"deploy.php"})," file and set the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$remoteUser = 'deployer';   // the user that will be used to connect to remote server and deploy the app\n$sudoPassword = '';  // the sudo password of the remote user\n\n$deployPath = '~/app';      // the path where the app will be deployed on the remote server\n\n$host = '';    // the host of the remote server (can be an IP or domain)\n$domain = '';   // the domain of the app\n\n$repository = 'git@github.com:username/saasykit.git';      // has to be in the SSH format\n$subDirectory = 'saasykit';                               // the subdirectory of the repository where the app is located (this is the directory that contains the composer.json file)\n\n$phpVersion = '8.2'; // the version of PHP to be installed on the server\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Don't change the ",(0,r.jsx)(n.code,{children:"$remoteUser"})," variable if you provision the server using Deployer, as it will create a new user with the name ",(0,r.jsx)(n.code,{children:"deployer"})," and add it to the ",(0,r.jsx)(n.code,{children:"sudo"})," group, you need to use this user to connect to the server and deploy the app."]})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Create a new repository on ",(0,r.jsx)(n.a,{href:"https://github.com",children:"GitHub"})," to host your app. Deployer will use that repository to deploy your app. You will need to add your SSH key to your GitHub account to be able to push to the repository later in the deployment section."]})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Run the provisioning command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/dep provision -o remote_user={{user}}  -o become=root -o identity_file=~/path/to/private/key.pem -vvv\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Replace ",(0,r.jsx)(n.code,{children:"{{user}}"})," with the user that you will use to connect to the server."]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Don't confuse the user that you will use to connect to the server in the above command (",(0,r.jsx)(n.code,{children:"remote_user"}),") with the ",(0,r.jsx)(n.code,{children:"remoteUser"})," variable in the ",(0,r.jsx)(n.code,{children:"deploy.php"})," file. The ",(0,r.jsx)(n.code,{children:"remoteUser"})," variable is the user that will be created on the server and used for deployment, but in order to create that user, you need to connect to the server using a different user that you typically receive from your cloud provider (e.g. ubuntu)."]})}),"\n",(0,r.jsxs)(n.p,{children:["Feel free to remove the ",(0,r.jsx)(n.code,{children:"identity_file"})," option in the command above if you don't use a private key to connect to the server."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Deployer will ask you a few questions (like which database you want to use, the credentials, etc.), answer them and press enter."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Go have a cup of coffee and wait for the provisioning to finish. \u2615\ufe0f  (might take 5 minutes or more depending on your server specs)"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["If the provisioning process fails at the provision",":website"," step, this means that there might be a permission problem (related to admin permissions), so please run the following:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/dep provision --start-from provision:website -vvv\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Once done, your server should be ready to go. Now let's ",(0,r.jsx)(n.a,{href:"#deploying-your-app",children:"deploy the app"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"deploying-your-app",children:"Deploying your app"}),"\n",(0,r.jsx)(n.p,{children:"Now you are about to experience the magic of Deployer. Deployer will deploy your app to the server with a single command."}),"\n",(0,r.jsx)(n.p,{children:"To configure the deployment process:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["(If you haven't already), create a new repository on ",(0,r.jsx)(n.a,{href:"https://github.com",children:"GitHub"})," (or Gitlab) to host your app. Deployer will use that repository to deploy your app on the server."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account",children:"Add your server's SSH"})," key to your GitHub account to be able to read the repository."]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you provisioned your server using Deployer, make sure that the SSH public key you'll add to Github is the one for ",(0,r.jsx)(n.code,{children:"deployer"})," user (which will be used for deployment), otherwise use the SSH public key for the user that you will use to deploy the app if you provisioned the server on your own."]})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["You can use the handy shortcut command ",(0,r.jsx)(n.code,{children:"./vendor/bin/dep ssh"})," to login to your server using SSH."]})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["(If you haven't already), open the ",(0,r.jsx)(n.code,{children:"deploy.php"})," file and set the following configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"$remoteUser = 'deployer';   // the user that will be used to connect to remote server and deploy the app\n$sudoPassword = '';  // the sudo password of the remote user\n\n$deployPath = '~/app';      // the path where the app will be deployed on the remote server\n\n$host = '';    // the host of the remote server (can be an IP or domain)\n$domain = '';   // the domain of the app\n\n$repository = 'git@github.com:username/saasykit.git';      // has to be in the SSH format\n$subDirectory = 'saasykit';                               // the subdirectory of the repository where the app is located (this is the directory that contains the composer.json file)\n\n$phpVersion = '8.2'; // the version of PHP to be installed on the server\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:['If you used Deployer to provision the app, set the "remoteUser" variable to ',(0,r.jsx)(n.code,{children:"deployer"}),", otherwise set it to the user that you will use to connect to the server and deploy the app."]})}),"\n",(0,r.jsxs)(n.p,{children:["For more info on each variable, read the comments beside each variable in the ",(0,r.jsx)(n.code,{children:"deploy.php"})," file."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Run the deployment command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/dep deploy \n"})}),"\n",(0,r.jsxs)(n.p,{children:["During your first deployment you will get the warning ",(0,r.jsx)(n.code,{children:"warning Your .env file is empty! Skipping..."}),". This is normal, as the ",(0,r.jsx)(n.code,{children:".env"})," file is not created yet. You will need to create it in the next step."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Create a ",(0,r.jsx)(n.code,{children:".env"})," file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/dep ssh\ncp .env.example ../../shared/.env\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Edit the ",(0,r.jsx)(n.code,{children:".env"})," file and set the necessary configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"nano ../../shared/.env\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Set the ",(0,r.jsx)(n.strong,{children:"APP_ENV"})," to ",(0,r.jsx)(n.code,{children:"production"}),", adjust the ",(0,r.jsx)(n.strong,{children:"LOG_LEVEL"}),", ",(0,r.jsx)(n.strong,{children:"APP_DEBUG"}),", ",(0,r.jsx)(n.strong,{children:"APP_URL"})," values and set the database credentials, redis, etc."]})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Generate a new application key:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"php artisan key:generate\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Exit the SSH session:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"exit\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Deploy the app again:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/dep deploy\n"})}),"\n",(0,r.jsx)(n.p,{children:"This time the deployment should succeed without any warnings! \ud83c\udf89"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Open your browser and visit your website's domain, you should see the app running."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["In the future, if do changes to your app, then push your changes to the repository and all what you have to do is to run the deployment command again ",(0,r.jsx)(n.code,{children:"./vendor/bin/dep deploy"}),", and Deployer will take care of the rest."]}),"\n",(0,r.jsxs)(n.p,{children:["For more info on how to use Deployer, check the ",(0,r.jsx)(n.a,{href:"https://deployer.org/docs/7.x/getting-started",children:"deployer official documentation"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Now you will need to ",(0,r.jsx)(n.a,{href:"#creating-your-admin-user",children:"create your admin user"})," to be able to access the admin panel."]}),"\n",(0,r.jsx)(n.h2,{id:"creating-your-admin-user",children:"Creating your admin user"}),"\n",(0,r.jsx)(n.p,{children:"To create an admin user:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Login to your server using SSH:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/dep ssh\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Run the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"php artisan app:create-admin-user\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Enter your user's email, and a password will be generated for your new account and displayed on the screen."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Head to ",(0,r.jsx)(n.code,{children:"/admin"})," on your website's domain (e.g. ",(0,r.jsx)(n.code,{children:"https://example.com/admin"}),") and login using the email and password that you just created. (You can change the password later from the admin panel)"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Once logged in, you will be redirected to the admin dashboard where you can start configuring your app."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,r.jsxs)(n.p,{children:["Now that you have your app deployed, you will need to configure the aspects of your app like the ",(0,r.jsx)(n.a,{href:"../settings",children:"settings"}),", ",(0,r.jsx)(n.a,{href:"../email",children:"email providers"}),", ",(0,r.jsx)(n.a,{href:"../payment-providers",children:"payment providers"}),", ",(0,r.jsx)(n.a,{href:"../oauth-social-login",children:"login providers"}),", ",(0,r.jsx)(n.a,{href:"../products-plans-and-pricing",children:"plans & products"}),", ",(0,r.jsx)(n.a,{href:"../users-and-roles",children:"users"}),", etc, before building your awesome SaaS product on top of ",(0,r.jsx)(n.strong,{children:"SaaSykit"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Check out the ",(0,r.jsx)(n.a,{href:"new-product-check-list",children:"product check list"})," for a more comprehensive list of things to do before launching your product."]}),"\n",(0,r.jsx)(n.h2,{id:"queue-workers",children:"Queue workers"}),"\n",(0,r.jsxs)(n.p,{children:["SaaSykit uses ",(0,r.jsx)(n.a,{href:"https://laravel.com/docs/horizon",children:"Laravel Horizon"})," to manage the queue workers. Horizon comes with a beautiful dashboard that allows you to monitor your queue workers, jobs, and failed jobs."]}),"\n",(0,r.jsxs)(n.p,{children:["To open the dashboard, visit the ",(0,r.jsx)(n.code,{children:"/horizon"})," route on your website's domain (e.g. ",(0,r.jsx)(n.code,{children:"https://example.com/horizon"}),")."]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Only admin ",(0,r.jsx)(n.a,{href:"../users-and-roles#users",children:"users"})," can access the Horizon dashboard."]})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you provisioned your server on your own, you will need to ",(0,r.jsx)(n.a,{href:"https://laravel.com/docs/10.x/horizon#installing-supervisor",children:"configure supervisor"})," to monitor the queue workers and keep horizon running in the background.\nIf you provisioned your server using Deployer, supervisor will be configured for you automatically."]})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting--faqs",children:"Troubleshooting & FAQs"}),"\n",(0,r.jsx)(n.h3,{id:"the-connection-for-this-site-is-not-secure",children:"The connection for this site is not secure?"}),"\n",(0,r.jsx)(n.p,{children:"If your server uses Caddy as web server (included in Deployer provisioning), This might be related to Caddy not being able to get the SSL certificate from Let's Encrypt (because of domain name issue). Have a look at the logs of Caddy and see if you can find any error:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"./vendor/bin/dep logs:caddy\n"})})]})}function c(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},1151:(e,n,o)=>{o.d(n,{Z:()=>d,a:()=>t});var r=o(7294);const s={},i=r.createContext(s);function t(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);